# –û—Ç—á—ë—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö (18.12.2024)

## –ó–∞–¥–∞—á–∞ #2: –ü–æ–ª–µ "–°–¥–∞—ë—Ç –∞–≤—Ç–æ —Å..."

**–§–∞–π–ª:** `app/serializers.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `renting_since` –≤ `LessorDetailSerializer`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞—Ç—É –ø–µ—Ä–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—è. –ï—Å–ª–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –Ω–µ—Ç ‚Äî `null`.

**–û—Ç–≤–µ—Ç API:**
```json
{
  "lessor": {
    "renting_since": "2021-11-18"
  }
}
```

**–ö–æ–º–º–∏—Ç:** `Feat: add renting_since field to LessorDetailSerializer`

---

## –ó–∞–¥–∞—á–∞ #3: –ó–∞–ø—Ä–µ—Ç –æ—Ç–º–µ–Ω—ã –ø–æ–µ–∑–¥–∫–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

**–§–∞–π–ª:** `chat/views.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –í endpoint `cancel-by-client` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Å–ø–µ—à–Ω—É—é –æ–ø–ª–∞—Ç—É

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –∫–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–µ–∑–¥–∫—É —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 403 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "–ü–æ–µ–∑–¥–∫–∞ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω–∞. –î–ª—è –æ—Ç–º–µ–Ω—ã –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É."

**–û—Ç–≤–µ—Ç API –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–º–µ–Ω—ã –æ–ø–ª–∞—á–µ–Ω–Ω–æ–π –ø–æ–µ–∑–¥–∫–∏:**
```json
{
  "detail": "–ü–æ–µ–∑–¥–∫–∞ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω–∞. –î–ª—è –æ—Ç–º–µ–Ω—ã –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É."
}
```

**–ö–æ–º–º–∏—Ç:** `Feat: block trip cancellation after payment - redirect to support`

---

## –ó–∞–¥–∞—á–∞ #4: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ –∞—Ä–µ–Ω–¥—ã (price_deposit)

**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–û—à–∏–±–∫–∞:**
```
{'price_deposit': [ErrorDetail(string='–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤–≤–µ–ª–∏ –Ω–µ –±–æ–ª–µ–µ 10 —Ü–∏—Ñ—Ä—ã.', code='max_digits')]}
```

**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç `max_digits` —Å 10 –¥–æ 15.

**–ë—ã–ª–æ:**
```python
price_deposit = DecimalField(decimal_places=2, max_digits=10)  # –º–∞–∫—Å: 99999999.99
```

**–°—Ç–∞–ª–æ:**
```python
price_deposit = DecimalField(decimal_places=2, max_digits=15)  # –º–∞–∫—Å: 9999999999999.99
```

**–§–∞–π–ª:** `vehicle/models.py`

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `0033_increase_price_deposit_max_digits.py`

**–ö–æ–º–º–∏—Ç:** `Feat: increase price_deposit max_digits from 10 to 15`

---

## –ó–∞–¥–∞—á–∞ #6: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞—è–≤–∫–∏ –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–µ–º

**–°—Ç–∞—Ç—É—Å:** –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞** (`chat/views.py`, –º–µ—Ç–æ–¥ `perform_update`):

–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ `status='denied'` –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ —ç—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
2. –¢—Ä–µ–±—É–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–∞–∑–∞ (`denied_reason`)
3. –°–æ–∑–¥–∞—ë—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—É: "–í–∞–º –æ—Ç–∫–∞–∑–∞–Ω–æ –≤ –∞—Ä–µ–Ω–¥–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ {vehicle} –ø–æ –ø—Ä–∏—á–∏–Ω–µ: {reason}"
4. –ó–∞—è–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `denied`

**API –∑–∞–ø—Ä–æ—Å:**
```
PATCH /chat/request_rents/{id}/
{
  "status": "denied",
  "denied_reason": "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã"
}
```

**–î–æ—Ä–∞–±–æ—Ç–∫–∏ –±—ç–∫–µ–Ω–¥–∞:** –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

---

## –ó–∞–¥–∞—á–∞ #7: –¶–µ–Ω—ã –Ω–∞ –º–∞—à–∏–Ω—ã –º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–°–∏–º–ø—Ç–æ–º:** –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (–ª—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ) –≤—Å–µ —Ü–µ–Ω—ã —É–≤–µ–ª–∏—á–∏–≤–∞–ª–∏—Å—å –Ω–∞ ~25%. –ö–∞–∂–¥–æ–µ –ø–æ—Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–Ω–æ–≤–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–ª–æ —Ü–µ–Ω—ã.

**–ü—Ä–∏—á–∏–Ω–∞ –±–∞–≥–∞:**

–í –º–æ–¥–µ–ª–∏ `RentPrice` –µ—Å—Ç—å –¥–≤–∞ –ø–æ–ª—è:
- `price` ‚Äî –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã (–≤–≤–æ–¥–∏—Ç –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å)
- `total` ‚Äî –∏—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞ —Å –∫–æ–º–∏—Å—Å–∏–µ–π (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

–†–∞—Å—á—ë—Ç `total` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –º–µ—Ç–æ–¥–µ `save()` –º–æ–¥–µ–ª–∏:
```python
def save(self, *args, **kwargs):
    commission = self.vehicle.owner.lessor.commission  # –Ω–∞–ø—Ä–∏–º–µ—Ä, 20%
    self.total = price / (100 - commission) * commission + price
    super().save(*args, **kwargs)
```

–ü—Ä–∏ **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏** —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `bulk_create()`:
```python
RentPrice.objects.bulk_create([...])
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `bulk_create()` –≤ Django **–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ `save()`** –º–æ–¥–µ–ª–∏ ‚Äî –æ–Ω –Ω–∞–ø—Ä—è–º—É—é –≤—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î. –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –ø–æ–ª–µ `total` –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å –ø—É—Å—Ç—ã–º –∏–ª–∏ –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª–æ—Å—å.

–ü—Ä–∏ **—Å–æ–∑–¥–∞–Ω–∏–∏** —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `create()`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç `save()` ‚Äî –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏–ª–∏ `bulk_create()` –Ω–∞ —Ü–∏–∫–ª —Å `create()`:

```python
# –ë—ã–ª–æ (–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç save):
RentPrice.objects.bulk_create([
    RentPrice(vehicle=instance, name=p['name'], price=..., discount=...)
    for p in prices_data
])

# –°—Ç–∞–ª–æ (–≤—ã–∑—ã–≤–∞–µ—Ç save –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏):
for p in prices_data:
    RentPrice.objects.create(
        vehicle=instance, name=p['name'], price=..., discount=...
    )
```

**–§–∞–π–ª:** `vehicle/serializers/base.py`

**–ö–æ–º–º–∏—Ç:** `Fix: use create() instead of bulk_create() for RentPrice to calculate total`

---

## –ó–∞–¥–∞—á–∞: –û—Ç–∑—ã–≤—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏

**–°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Flutter

**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É "Rental status is current, not finished".

**–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ Flutter:**

1. PATCH –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–µ–∑–¥–∫–∏ **—É—Å–ø–µ—à–µ–Ω**:
   ```
   üèÅ Finishing trip 159
   ‚úÖ Trip 159 finished: {status: finished, ...}
   ```

2. –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å `finished`

3. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ Flutter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ**:
   ```
   ‚≠ê Submitting rating for rental: id=159, status=current
   ‚ö†Ô∏è Rental status is "current", not "finished"
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î:** Trip 159 –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å `finished` ‚Äî –±—ç–∫–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–ü—Ä–∏—á–∏–Ω–∞:** Flutter –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ PATCH –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç rental –≤ –ø–∞–º—è—Ç–∏. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –∏–∑ –∫—ç—à–∞ (`current`), –∞ –Ω–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ (`finished`).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:**

1. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ PATCH `/chat/trips/{id}/` —Å `status: finished` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç rental –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞
2. –ò–ª–∏: –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ä–µ–π—Ç–∏–Ω–≥–∞ –¥–µ–ª–∞—Ç—å GET –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
3. –ò–ª–∏: —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ –¥–æ–≤–µ—Ä—è—Ç—å —Å–µ—Ä–≤–µ—Ä—É (—Å–µ—Ä–≤–µ—Ä —Å–∞–º –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ–≤–µ—Ä–Ω—ã–π)

**–î–æ—Ä–∞–±–æ—Ç–∫–∏ –±—ç–∫–µ–Ω–¥–∞:** –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

---

## –ó–∞–¥–∞—á–∞ #11: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –ø–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** –í—ã–ø–æ–ª–Ω–µ–Ω–æ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –ù–æ–≤—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–≤–µ—Ä—Ö—É –Ω–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è ‚Äî –≤–≤–µ—Ä—Ö—É –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `verified_at`** –≤ –º–æ–¥–µ–ª—å `Vehicle` (`vehicle/models.py`)
   - –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–º/–º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
   - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–Ω—è—Ç–∏–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏** (`vehicle/serializers/base.py`)
   - –ü—Ä–∏ `verified=True` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `verified_at=timezone.now()`
   - –ü—Ä–∏ —Å–±—Ä–æ—Å–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ `verified_at=None`

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** –¥–ª—è –≤—Å–µ—Ö ViewSet (Auto, Bike, Ship, Helicopter, SpecialTechnic):
   - –ù–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `-created_at` (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
   - –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `-verified_at` (–Ω–µ–¥–∞–≤–Ω–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –ø–µ—Ä–≤—ã–º–∏)

**–§–∞–π–ª—ã:** `vehicle/models.py`, `vehicle/views.py`, `vehicle/serializers/base.py`

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `0032_vehicle_verified_at.py`

**–ö–æ–º–º–∏—Ç:** `Feat: add verified_at field and sort verified vehicles by verification date`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ë—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:
```sql
SELECT id, created_at FROM vehicle_vehicle WHERE verified = false ORDER BY created_at DESC LIMIT 5;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 153, 151, 150, 149, 145 (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
```

–ï—Å–ª–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –¥—Ä—É–≥–æ–π ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–≤–æ–∑–º–æ–∂–Ω–æ, —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `ordering`).

---

## –ó–∞–¥–∞—á–∞ #12: –ö–æ–º–∏—Å—Å–∏—è –Ω–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏

**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (‚ö†Ô∏è —Ç—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∏—Å—Å–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª–∞—Å—å –æ—Ç `total_cost`, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏. –ü—Ä–∏ –∫–æ–º–∏—Å—Å–∏–∏ 20% –∏ –¥–æ—Å—Ç–∞–≤–∫–µ 750‚ÇΩ ‚Äî –ª–∏—à–Ω–∏–µ 150‚ÇΩ.

**–ë—ã–ª–æ:**
```python
def calculate_amount(self):
    commission = self.vehicle.owner.lessor.commission
    return Decimal(self.total_cost) * commission / Decimal(100)
```

**–°—Ç–∞–ª–æ:**
```python
def calculate_amount(self):
    commission = self.vehicle.owner.lessor.commission
    rent_cost = Decimal(self.total_cost) - Decimal(self.delivery_cost or 0)
    return rent_cost * commission / Decimal(100)
```

**–§–∞–π–ª:** `chat/models.py`

**–ö–æ–º–º–∏—Ç:** `Fix: exclude delivery cost from commission calculation`

**‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –£–¢–û–ß–ù–ï–ù–ò–Ø:**

–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:
- `Payment.amount` = –∫–æ–º–∏—Å—Å–∏—è (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Tinkoff)
- `Payment.delivery` = —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Tinkoff)

–í–æ–ø—Ä–æ—Å—ã:
1. –î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Tinkoff –≤–º–µ—Å—Ç–µ —Å –∫–æ–º–∏—Å—Å–∏–µ–π?
2. –ò–ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∞ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ (–Ω–∞–ª–∏—á–Ω—ã–º–∏ –∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—é)?

–ï—Å–ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É ‚Äî –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å `payment/views.py`:
```python
total_to_pay = payment.amount + payment.delivery
```

---
